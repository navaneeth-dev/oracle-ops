# prettier-ignore
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: authentik
  namespace: authentik
spec:
  chart:
    spec:
      chart: authentik
      version: 2025.10.3
      sourceRef:
        kind: HelmRepository
        name: authentik
        namespace: flux-system
  timeout: 10m0s
  interval: 1h0m0s

  values:
    fullnameOverride: authentik

    global:
      env:
       - name: AUTHENTIK_POSTGRESQL__PASSWORD
         valueFrom:
           secretKeyRef:
             name: authentik-app
             key: password
      envFrom:
        - secretRef:
            name: authentik-secrets

    server:
      route:
        main:
          enabled: true
          hostnames:
            - 'authentik.${DOMAIN}'
          parentRefs:
            - kind: Gateway
              name: reverse-proxy
              namespace: envoy-gateway-system
